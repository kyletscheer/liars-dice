<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Liar's Dice Calculator</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"],
          ],
        },
        startup: {
          ready: () => {
            MathJax.startup.defaultReady();
            // Now patch updateMathView
            const oldUpdate = updateMathView;
            updateMathView = function (...args) {
              oldUpdate.apply(this, args);
              MathJax.typesetPromise();
            };
          },
        },
      };
    </script>
<link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="title">
          <span class="title-icon">üé≤</span>
          <span>Liar's Dice Calculator</span>
        </div>
        <div class="header-controls">
          <div class="nav-buttons" id="navButtons">
            <button id="navCalculator">üìä Calculator</button>
            <button id="navMath" class="secondary">üìà How It Works</button>
          </div>
          <button class="mode-toggle" id="pipsToggle" title="Toggle pip view">
            5
          </button>
          <button class="theme-toggle" id="themeToggle">üåô</button>
        </div>
<div id="ios-cta-container">
  <a href="https://kylescheer.com/apps/liarsdice" target="_blank" rel="noopener noreferrer" aria-label="Download on the App Store">
    <img src="app-store-badge.png" alt="Download on the App Store" style="height: 50px;">
  </a>
</div>      </header>

      <!-- Game Setup Card (appears on all views) -->
      <div class="main-layout">
        <div class="setup-column">
          <div class="card" id="setupCard">
            <div class="card-title">üéÆ Game Setup</div>
            <div id="alertMessage" class="alert-message"></div>

            <div class="form-group spinner-input-small">
              <label>Total Dice in Play</label>
              <div class="spinner-input">
                <button onclick="decrementTotal()">‚àí</button>
                <input type="number" id="totalDice" value="15" readonly />
                <button onclick="incrementTotal()">+</button>
              </div>
            </div>

            <div class="form-group">
              <label>Your Dice</label>
              <div class="dice-grid" id="diceInput"></div>
              <div class="die-chip-display" id="yourDiceDisplay"></div>
            </div>

            <div class="section-divider"><span>Previous Claim</span></div>

            <div class="claim-input-row">
              <div class="form-group">
                <label for="claimQuantity">Quantity</label>
                <div class="spinner-input">
                  <button onclick="decrementQuantity()">‚àí</button>
                  <input type="number" id="claimQuantity" value="5" readonly />
                  <button onclick="incrementQuantity()">+</button>
                </div>
              </div>
              <div class="form-group">
                <label>Face</label>
                <button
                  class="die-selector"
                  id="claimFaceButton"
                  onclick="rotateFace()"
                >
                  3
                </button>
              </div>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="wildOnes" checked /> 1s are Wild
              </label>
            </div>

            <div class="section-divider">
              <span>For Adjusted Probability</span>
            </div>

            <div class="form-group">
              <label>Claimant's Dice</label>
              <div class="spinner-input">
                <button onclick="decrementClaimant()">‚àí</button>
                <input type="number" id="claimantDice" value="5" readonly />
                <button onclick="incrementClaimant()">+</button>
              </div>
            </div>

            <div class="form-group">
              <label for="bluffRate"
                >Bluff Rate: <span id="bluffRateValue">10</span>%</label
              >
              <input type="range" id="bluffRate" min="0" max="100" value="10" />
            </div>
          </div>
        </div>

        <!-- Results Column -->
        <div class="results-column" id="resultsColumn">
          <!-- Calculator View -->
          <div id="calculatorView" class="view-section active">
            <!-- Probabilities Card -->
            <div
              class="card result-card"
              data-section="probabilities"
              draggable="true"
            >
              <div class="card-title" onclick="toggleSection('probabilities')">
                <span>üìä Results</span>
                <div class="card-controls">
                  <span class="eye-icon">üëÅÔ∏è</span>
                </div>
              </div>
              <div class="card-content">
                <div class="results-box">
                  <div class="results-box-label">Normal Probability</div>
                  <div class="results-box-value" id="normalProb">0.0%</div>
                </div>
                <div class="results-box">
                  <div class="results-box-label">Adjusted Probability</div>
                  <div class="results-box-value" id="adjustedProb">0.0%</div>
                </div>
              </div>
            </div>

            <!-- Recommended Move Card -->
            <div
              class="card result-card"
              data-section="recommended"
              draggable="true"
            >
              <div class="card-title" onclick="toggleSection('recommended')">
                <span>üéØ Highest Probability Move</span>
                <div class="card-controls">
                  <span class="eye-icon">üëÅÔ∏è</span>
                </div>
              </div>
              <div class="card-content">
                <div id="recommendedMove"></div>
              </div>
            </div>

            <!-- Distribution Card -->
            <div
              class="card result-card"
              data-section="distribution"
              draggable="true"
            >
              <div class="card-title" onclick="toggleSection('distribution')">
                <span>üìà Expected Distribution</span>
                <div class="card-controls">
                  <span class="eye-icon">üëÅÔ∏è</span>
                </div>
              </div>
              <div class="card-content">
                <div class="distribution-grid" id="distributionGrid"></div>
              </div>
            </div>

            <!-- Next Moves Card -->
            <div class="card result-card" data-section="moves" draggable="true">
              <div class="card-title" onclick="toggleSection('moves')">
                <span>üéØ Next Possible Moves</span>
                <div class="card-controls">
                  <span class="eye-icon">üëÅÔ∏è</span>
                </div>
              </div>
              <div class="card-content">
                <table class="moves-table">
                  <thead>
                    <tr>
                      <th>Move</th>
                      <th>Normal Prob.</th>
                      <th>Adjusted Prob.</th>
                    </tr>
                  </thead>
                  <tbody id="movesTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Math View -->
          <div id="mathView" class="view-section">
            <div class="card">
              <h2>üìà How the Math Works</h2>
              <p>
                Learn about the probability calculations that power the Liar's
                Dice Calculator.
              </p>
            </div>

            <!-- Normal Probability Section -->
            <div class="card">
              <h2>Normal Probability</h2>
              <p>
                The normal probability is the chance a claim is true based on
                all unknown dice in the game, treating them as a single random
                pool. It doesn't consider the claimant's hand or bluffing.
              </p>

              <div class="step-card">
                <h3>1Ô∏è‚É£ Count Your Contribution</h3>
                <p>
                  First, we count how many dice in your hand contribute to the
                  claim. Ones are wild and count as any number.
                </p>
                <div id="normalStep1" class="math-block"></div>
              </div>

              <div class="step-card">
                <h3>2Ô∏è‚É£ Unknown Dice Pool</h3>
                <p>
                  Next, we calculate the total number of dice that are unknown
                  to you. This includes the dice held by all other players. We
                  also determine the remaining needed dice to meet the claim.
                </p>
                <div id="normalStep2" class="math-block"></div>
              </div>

              <div class="step-card">
                <h3>3Ô∏è‚É£ Binomial Probability</h3>
                <p>
                  We use the binomial formula to find the probability of getting
                  exactly the required number of dice (or more) from the unknown
                  pool. What's the probability the unknown dice provide what you
                  need?
                </p>
                <div class="math-block">
                  <strong>Generic Formula:</strong>
                  <div id="normalFormulaGeneric"></div>
                </div>
                <div class="math-block">
                  <strong>Formula:</strong>
                  <div id="normalFormula" style="margin-top: 10px"></div>
                </div>
                <div class="table-container">
                  <table id="normalTable">
                    <thead>
                      <tr>
                        <th>k</th>
                        <th>Calculation</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
              <div class="card">
                <h3>4Ô∏è‚É£ Final Probability</h3>
                <p>
                  Finally, we sum the probabilities of getting exactly the
                  number of matches we need and all higher possibilities.
                </p>
                <div class="final-result" id="finalNormalResult"></div>
              </div>
            </div>

            <!-- Adjusted Probability Section -->
            <div class="card">
              <h2>Adjusted Probability (Bayesian)</h2>
              <p>
                The adjusted probability is a more sophisticated calculation
                that factors in the claimant's dice and a bluffing model using
                Bayesian inference. It's the probability the claim is true,
                <i>given that the claimant made it</i>.
              </p>

              <div class="step-card">
                <h3>1Ô∏è‚É£ Count Your Dice Contribution</h3>
                <p>
                  Look at your dice and count how many show the claimed number.
                  Ones are wild and count as any number. The remaining needed
                  dice must come from other players.
                </p>
                <div id="adjStep1" class="math-block"></div>
              </div>

              <div class="step-card">
                <h3>2Ô∏è‚É£ Calculate Prior Probabilities (Binomial)</h3>
                <p>
                  We calculate the probability each possible number of claimant
                  dice contribute to the claim using the binomial formula. The
                  example table below shows the probabilities for to 5 matches
                  from the claimant's dice.
                  <i
                    >What are the likely distributions of the claimant's
                    dice?</i
                  >
                </p>
                <div class="math-block">
                  <strong>Generic Formula:</strong>
                  <div id="adjFormulaGeneric1" style="margin-top: 10px"></div>
                </div>
                <div class="math-block">
                  <strong>Formula:</strong>
                  <div id="adjFormula1" style="margin-top: 10px"></div>
                </div>
                <div class="table-container">
                  <table id="priorTable">
                    <thead>
                      <tr>
                        <th>k</th>
                        <th>Calculation</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <div class="step-card">
                <h3>3Ô∏è‚É£ Account for Bluffing with Bayes' Theorem</h3>
                <p>
                  The claim might be exaggerated. We estimate the probability of
                  the claim being made given a certain number of matches a
                  player holds, considering a fixed bluff rate.
                  <i
                    >When would the claimant make this claim given their
                    hand?</i
                  >
                </p>
                <div id="adjStep3" class="math-block"></div>
              </div>

              <div class="step-card">
                <h3>4Ô∏è‚É£ Calculate Posterior Probabilities</h3>
                <p>
                  We use Bayes' Theorem to adjust the prior probabilities based
                  on the fact that a claim was made. This gives us a new
                  probability distribution for the number of matches the
                  claimant holds, called the posterior probability.
                </p>
                <div class="math-block">
                  <strong>Generic Formula:</strong>
                  <div id="adjFormula2" style="margin-top: 10px"></div>
                </div>
                <div class="table-container">
                  <table id="posteriorTable">
                    <thead>
                      <tr>
                        <th>k</th>
                        <th>Calculation</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <div class="step-card">
                <h3>5Ô∏è‚É£ Calculate Probability Claim is True</h3>
                <p>
                  For each possible number of matches the claimant holds
                  (\(K\)), we calculate the probability that the remaining
                  unknown dice satisfy the claim. We use a binomial tail sum for
                  this.
                </p>

                <div
                  class="math-block"
                >
                  <p><strong>Generic Formula:</strong></p>
                  <div id="adj-step5-formula-generic"></div>
                </div>

                <div class="table-container">
                  <table id="probTrueTable">
                    <thead>
                      <tr>
                        <th>\(k\)</th>
                        <th>Calculation</th>
                        <th>Value</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <div class="step-card">
                <h3>6Ô∏è‚É£ Final Adjusted Probability</h3>
                <p>
                   Finally, we multiply the posterior probabilities by the probability the claim is true for each and sum them up. This is the final adjusted probability the claim is likely true, considering both dice probability and bluffing. 
                </p>
                <div class="math-block">
                  <strong>Generic Formula:</strong>
                  <div id="adjFinalFormulaGeneric" style="margin-top: 10px"></div>
                </div>
                <div class="table-container">
                  <table id="finalAdjTable">
                    <thead>
                      <tr>
                        <th>k</th>
                        <th>Posterior</th>
                        <th>P(true|k)</th>
                        <th>Weighted Product</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <div class="final-result" id="finalAdjResult"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- Footer -->
      <footer class="border-top text-center py-4 mt-auto">
        <div>
          Made by
          <a href="https://www.kylescheer.com" target="_blank">Kyle Scheer</a>
        </div>
        <br />
        <a href="https://github.com/kyletscheer/liars-dice/" target="_blank"
          >View Code</a
        ><br /><br />
        <p>
          <a
            href="https://ko-fi.com/scheerapps"
            target="_blank"
            rel="noopener"
            title="Support me on Ko-fi"
          >
            <img
              height="36"
              style="border: 0px; height: 36px"
              src="https://storage.ko-fi.com/cdn/kofi5.png?v=6"
              border="0"
              alt="Buy Me a Coffee at ko-fi.com"
            />
          </a>
        </p>
      </footer>
    </div>

    <script src="script.js"></script>
  </body>
</html>